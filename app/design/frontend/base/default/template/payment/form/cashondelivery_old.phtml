<?php

/**

 * Magento

 *

 * NOTICE OF LICENSE

 *

 * This source file is subject to the Academic Free License (AFL 3.0)

 * that is bundled with this package in the file LICENSE_AFL.txt.

 * It is also available through the world-wide-web at this URL:

 * http://opensource.org/licenses/afl-3.0.php

 * If you did not receive a copy of the license and are unable to

 * obtain it through the world-wide-web, please send an email

 * to license@magentocommerce.com so we can send you a copy immediately.

 *

 * DISCLAIMER

 *

 * Do not edit or add to this file if you wish to upgrade Magento to newer

 * versions in the future. If you wish to customize Magento for your

 * needs please refer to http://www.magentocommerce.com for more information.

 *

 * @category    design

 * @package     base_default

 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)

 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)

 */



/**

 * @see Saas_Payment_Block_Form_Cashondelivery

 */

?>
<?php /**
Payment Perapal
**/?>
<?php $_code=$this->getMethodCode() ?>
<ul class="form-list" id="payment_form_<?php echo $_code ?>" style="display:none;">
    <li style="clear: both;"><strong><?php echo $this->__('Only delivery address in Metro Manila, selected areas in Laguna, Cavite, Rizal, and Bulacan.') ?></strong></li>
</ul>
<?php /**
Edited by Paul Afan
**/?>


<?php if ($this->getInstructions()): ?>

    <ul class="form-list checkout-agreements" id="payment_form_<?php echo $this->getMethodCode() ?>" style="display:none;">

        <li>

            <div class="<?php echo $this->getMethodCode() ?>-instructions-content agreement-content">

                <?php echo nl2br($this->getInstructions()) ?>

            </div>

        </li>

    </ul>

<?php endif; ?>

<script>
(function(){

	check(jQuery('#rid').val(),jQuery('#shipping_city').val());

   	jQuery(document).on('change','#shipping_city', function(){
  		check(jQuery('#shipping_region_id').val(),jQuery('#shipping_city').val());
   	});

   	jQuery(document).on('change','#shipping_region_id', function(){
  		check(jQuery('#shipping_region_id').val(),jQuery('#shipping_city').val());

   	});

  	 function check(state_id,city_id){		
		
		var array_state ='<?php $stateprovince2 = Mage::getStoreConfig('payment/cashondelivery/stateprovince');
							$default_state = '';
							$stateprovince2 = explode(',', $stateprovince2);

							foreach($stateprovince2 as $stateprovince){
								$default_state .= $stateprovince .","; 
							} 
							echo substr($default_state,0,-1); ?>';



		var array_city ='<?php $city2 = Mage::getStoreConfig('payment/cashondelivery/city');
							$default_city = ''; 
							$city2 = explode(',', $city2);
							foreach($city2 as $city){ 
									$default_city .= $city .","; } 
							echo substr($default_city,0,-1); ?>';

   	
		var splitObj = array_state.split(","); 
		var splitObj2 = array_city.split(",");

		if(jQuery.inArray(state_id, splitObj) !=-1 && jQuery.inArray(city_id, splitObj2) !=-1){
			console.log(1);
			jQuery('input#p_method_cashondelivery').attr('disabled', false);
			jQuery("label[for='p_method_cashondelivery']").attr('disabled', false);

		}else{
			console.log(2);

			jQuery('input#p_method_cashondelivery').attr('disabled', true);
			jQuery('input#p_method_cashondelivery').removeAttr("checked");
			jQuery("label[for='p_method_cashondelivery']").attr('disabled', true);
			jQuery("#payment_form_cashondelivery").css('display', 'none');
		}

   }


})();

</script>


